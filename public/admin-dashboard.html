<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Dr. Ayurveda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ayur-green': '#4A7C59',
                        'ayur-light-green': '#6FAF7C',
                        'ayur-beige': '#F5E6D3',
                        'ayur-brown': '#8B4513',
                        'ayur-gold': '#DAA520'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-ayur-beige min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-ayur-green rounded-full flex items-center justify-center">
                        <span class="text-white font-bold">ðŸŒ¿</span>
                    </div>
                    <h1 class="text-xl font-bold text-ayur-green">Admin Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" target="_blank" class="text-ayur-green hover:text-ayur-light-green">
                        View Website
                    </a>
                    <form method="POST" action="/admin/logout" class="inline">
                        <button type="submit" class="bg-ayur-green text-white px-4 py-2 rounded hover:bg-ayur-light-green transition">
                            Logout
                        </button>
                    </form>
                </div>
            </div>
        </nav>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Navigation Tabs -->
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8">
                    <button id="products-tab" onclick="showTab('products')" class="tab-button border-b-2 border-ayur-green text-ayur-green py-2 px-1 font-medium text-sm">
                        Manage Products
                    </button>
                    <button id="profile-tab" onclick="showTab('profile')" class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-2 px-1 font-medium text-sm">
                        Doctor Profile
                    </button>
                    <button id="brand-tab" onclick="showTab('brand')" class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-2 px-1 font-medium text-sm">
                        Brand Settings
                    </button>
                    <button id="account-tab" onclick="showTab('account')" class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-2 px-1 font-medium text-sm">
                        Account Settings
                    </button>
                </nav>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products-content" class="tab-content">
            <!-- Add Product Form -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-xl font-bold text-ayur-green mb-6">Add New Product</h2>
                <form id="product-form" enctype="multipart/form-data" class="space-y-4">
                    <input type="hidden" id="edit-product-id" value="">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="product-name" class="block text-sm font-medium text-ayur-brown mb-2">Product Name *</label>
                            <input type="text" id="product-name" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent">
                        </div>
                        <div>
                            <label for="product-price" class="block text-sm font-medium text-ayur-brown mb-2">Price (â‚¹)</label>
                            <input type="text" id="product-price" name="price" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="299">
                        </div>
                    </div>

                    <div>
                        <label for="product-image" class="block text-sm font-medium text-ayur-brown mb-2">Product Image</label>
                        <input type="file" id="product-image" name="image" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent">
                        <div id="image-preview" class="mt-2 hidden">
                            <img id="preview-img" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg">
                        </div>
                    </div>

                    <div>
                        <label for="product-description" class="block text-sm font-medium text-ayur-brown mb-2">Description *</label>
                        <textarea id="product-description" name="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Describe your product..."></textarea>
                    </div>

                    <div>
                        <label for="product-ingredients" class="block text-sm font-medium text-ayur-brown mb-2">Ingredients</label>
                        <textarea id="product-ingredients" name="ingredients" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="List the key ingredients..."></textarea>
                    </div>

                    <div>
                        <label for="product-benefits" class="block text-sm font-medium text-ayur-brown mb-2">Benefits</label>
                        <textarea id="product-benefits" name="benefits" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Describe the health benefits..."></textarea>
                    </div>

                    <div>
                        <label for="product-usage" class="block text-sm font-medium text-ayur-brown mb-2">Usage Instructions</label>
                        <textarea id="product-usage" name="usage" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="How to use this product..."></textarea>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" id="submit-btn" class="bg-ayur-green text-white px-6 py-2 rounded-lg hover:bg-ayur-light-green transition">
                            Add Product
                        </button>
                        <button type="button" id="cancel-btn" onclick="cancelEdit()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition hidden">
                            Cancel Edit
                        </button>
                    </div>
                </form>
            </div>

            <!-- Products List -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-ayur-green mb-6">Existing Products</h2>
                <div id="products-list" class="space-y-4">
                    <!-- Products will be loaded here -->
                    <div class="text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-ayur-green"></div>
                        <p class="mt-2 text-ayur-brown">Loading products...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile-content" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-ayur-green mb-6">Doctor Profile Information</h2>
                <form id="profile-form" enctype="multipart/form-data" class="space-y-4">
                    
                    <!-- Doctor Photo Upload -->
                    <div>
                        <label for="doctor-photo" class="block text-sm font-medium text-ayur-brown mb-2">Doctor's Photo</label>
                        <input type="file" id="doctor-photo" name="photo" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent">
                        <div id="doctor-photo-preview" class="mt-2 hidden">
                            <img id="doctor-preview-img" src="" alt="Doctor Preview" class="w-32 h-32 object-cover rounded-lg">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="doctor-name" class="block text-sm font-medium text-ayur-brown mb-2">Doctor Name *</label>
                            <input type="text" id="doctor-name" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent">
                        </div>
                        <div>
                            <label for="doctor-contact" class="block text-sm font-medium text-ayur-brown mb-2">Contact Number *</label>
                            <input type="tel" id="doctor-contact" name="contact" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="+91-9876543210">
                        </div>
                    </div>

                    <div>
                        <label for="doctor-email" class="block text-sm font-medium text-ayur-brown mb-2">Email Address *</label>
                        <input type="email" id="doctor-email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="doctor@clinic.com">
                    </div>

                    <div>
                        <label for="doctor-address" class="block text-sm font-medium text-ayur-brown mb-2">Clinic Address *</label>
                        <textarea id="doctor-address" name="address" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Enter your clinic address..."></textarea>
                    </div>

                    <div>
                        <label for="doctor-bio" class="block text-sm font-medium text-ayur-brown mb-2">Bio/Introduction *</label>
                        <textarea id="doctor-bio" name="bio" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Tell visitors about your experience and specialization..."></textarea>
                    </div>

                    <button type="submit" class="bg-ayur-green text-white px-6 py-2 rounded-lg hover:bg-ayur-light-green transition">
                        Update Profile
                    </button>
                </form>
            </div>
        </div>

        <!-- Brand Settings Tab -->
        <div id="brand-content" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-ayur-green mb-6">Brand Settings</h2>
                <form id="brand-form" enctype="multipart/form-data" class="space-y-4">
                    
                    <!-- Brand Logo Upload -->
                    <div>
                        <label for="brand-logo" class="block text-sm font-medium text-ayur-brown mb-2">Brand Logo</label>
                        <input type="file" id="brand-logo" name="logo" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Recommended size: 200x200px or square format</p>
                        <div id="brand-logo-preview" class="mt-2 hidden">
                            <img id="brand-preview-img" src="" alt="Logo Preview" class="w-24 h-24 object-cover rounded-lg">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="brand-name" class="block text-sm font-medium text-ayur-brown mb-2">Brand Name</label>
                            <input type="text" id="brand-name" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Dr. Ayurveda">
                            <p class="text-xs text-gray-500 mt-1">This will appear in the header and throughout the website</p>
                        </div>
                        <div>
                            <label for="brand-tagline" class="block text-sm font-medium text-ayur-brown mb-2">Brand Tagline</label>
                            <input type="text" id="brand-tagline" name="tagline" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Natural Healing Through Ayurveda">
                            <p class="text-xs text-gray-500 mt-1">This will appear in the hero section of the homepage</p>
                        </div>
                    </div>

                    <button type="submit" class="bg-ayur-green text-white px-6 py-2 rounded-lg hover:bg-ayur-light-green transition">
                        Update Brand Settings
                    </button>
                </form>

                <!-- Brand Preview -->
                <div class="mt-8 p-4 bg-ayur-beige rounded-lg">
                    <h3 class="text-lg font-semibold text-ayur-brown mb-4">Header Preview</h3>
                    <div class="flex items-center space-x-2 p-4 bg-white rounded shadow-sm">
                        <div id="preview-logo" class="w-12 h-12 bg-ayur-green rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-xl">ðŸŒ¿</span>
                        </div>
                        <h1 id="preview-name" class="text-2xl font-bold text-ayur-green">Dr. Ayurveda</h1>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Settings Tab -->
        <div id="account-content" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-ayur-green mb-6">Account Settings</h2>
                
                <!-- Change Password Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-ayur-brown mb-4">Change Password</h3>
                    <form id="password-form" class="space-y-4 max-w-md">
                        <div>
                            <label for="current-password" class="block text-sm font-medium text-ayur-brown mb-2">Current Password *</label>
                            <input type="password" id="current-password" name="currentPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Enter current password">
                        </div>

                        <div>
                            <label for="new-password" class="block text-sm font-medium text-ayur-brown mb-2">New Password *</label>
                            <input type="password" id="new-password" name="newPassword" required minlength="6" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Enter new password (min 6 characters)">
                        </div>

                        <div>
                            <label for="confirm-password" class="block text-sm font-medium text-ayur-brown mb-2">Confirm New Password *</label>
                            <input type="password" id="confirm-password" name="confirmPassword" required minlength="6" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayur-green focus:border-transparent" placeholder="Confirm new password">
                        </div>

                        <button type="submit" class="bg-ayur-green text-white px-6 py-2 rounded-lg hover:bg-ayur-light-green transition">
                            Update Password
                        </button>
                    </form>
                </div>

                <!-- Account Information -->
                <div class="border-t pt-6">
                    <h3 class="text-lg font-semibold text-ayur-brown mb-4">Account Information</h3>
                    <div class="space-y-2 text-sm text-gray-600">
                        <p><strong>Username:</strong> doctor</p>
                        <p><strong>Role:</strong> Administrator</p>
                        <p><strong>Last Login:</strong> <span id="last-login">Current Session</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="message" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg hidden z-50">
        <span id="message-text"></span>
    </div>

    <script>
        let currentTab = 'products';

        // Tab switching
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('border-ayur-green', 'text-ayur-green');
                button.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-content').classList.remove('hidden');
            
            // Add active class to selected tab
            const activeTab = document.getElementById(tabName + '-tab');
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-ayur-green', 'text-ayur-green');
            
            currentTab = tabName;
        }

        // Show message
        function showMessage(text, type = 'success') {
            const message = document.getElementById('message');
            const messageText = document.getElementById('message-text');
            
            messageText.textContent = text;
            message.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            message.classList.remove('hidden');
            
            setTimeout(() => {
                message.classList.add('hidden');
            }, 3000);
        }

        // Image preview for doctor photo
        document.getElementById('doctor-photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('doctor-preview-img').src = e.target.result;
                    document.getElementById('doctor-photo-preview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('doctor-photo-preview').classList.add('hidden');
            }
        });

        // Image preview for brand logo
        document.getElementById('brand-logo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('brand-preview-img').src = e.target.result;
                    document.getElementById('brand-logo-preview').classList.remove('hidden');
                    
                    // Update preview
                    document.getElementById('preview-logo').innerHTML = `<img src="${e.target.result}" alt="Logo" class="w-full h-full object-cover rounded-full">`;
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('brand-logo-preview').classList.add('hidden');
                document.getElementById('preview-logo').innerHTML = '<span class="text-white font-bold text-xl">ðŸŒ¿</span>';
            }
        });

        // Update brand name preview
        document.getElementById('brand-name').addEventListener('input', function(e) {
            const name = e.target.value || 'Dr. Ayurveda';
            document.getElementById('preview-name').textContent = name;
        });
        document.getElementById('product-image').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('image-preview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('image-preview').classList.add('hidden');
            }
        });

        // Load products
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                
                const productsList = document.getElementById('products-list');
                
                if (products.length === 0) {
                    productsList.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-4xl mb-4">ðŸŒ¿</div>
                            <p class="text-ayur-brown">No products added yet. Add your first product above!</p>
                        </div>
                    `;
                    return;
                }
                
                const productsHTML = products.map(product => `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="w-full md:w-32 h-32 bg-ayur-beige rounded-lg flex items-center justify-center flex-shrink-0">
                                ${product.image ? 
                                    `<img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover rounded-lg">` :
                                    `<div class="text-2xl text-ayur-green">ðŸŒ¿</div>`
                                }
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-ayur-green mb-2">${product.name}</h3>
                                <p class="text-ayur-brown mb-2">${product.description}</p>
                                ${product.price ? `<p class="text-lg font-bold text-ayur-gold mb-2">â‚¹${product.price}</p>` : ''}
                                <div class="flex space-x-2">
                                    <button onclick="editProduct('${product._id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition">
                                        Edit
                                    </button>
                                    <button onclick="deleteProduct('${product._id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                productsList.innerHTML = productsHTML;
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('products-list').innerHTML = '<p class="text-red-500 text-center">Error loading products.</p>';
            }
        }

        // Load doctor profile
        async function loadDoctorProfile() {
            try {
                const response = await fetch('/api/doctor');
                const doctor = await response.json();
                
                document.getElementById('doctor-name').value = doctor.name || '';
                document.getElementById('doctor-contact').value = doctor.contact || '';
                document.getElementById('doctor-email').value = doctor.email || '';
                document.getElementById('doctor-address').value = doctor.address || '';
                document.getElementById('doctor-bio').value = doctor.bio || '';
                
                if (doctor.photo) {
                    document.getElementById('doctor-preview-img').src = doctor.photo;
                    document.getElementById('doctor-photo-preview').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading doctor profile:', error);
            }
        }

        // Load brand settings
        async function loadBrandSettings() {
            try {
                const response = await fetch('/api/brand');
                const brand = await response.json();
                
                document.getElementById('brand-name').value = brand.name || 'Dr. Ayurveda';
                document.getElementById('brand-tagline').value = brand.tagline || 'Natural Healing Through Ayurveda';
                document.getElementById('preview-name').textContent = brand.name || 'Dr. Ayurveda';
                
                if (brand.logo) {
                    document.getElementById('brand-preview-img').src = brand.logo;
                    document.getElementById('brand-logo-preview').classList.remove('hidden');
                    document.getElementById('preview-logo').innerHTML = `<img src="${brand.logo}" alt="Logo" class="w-full h-full object-cover rounded-full">`;
                }
            } catch (error) {
                console.error('Error loading brand settings:', error);
            }
        }

        // Product form submission
        document.getElementById('product-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const editId = document.getElementById('edit-product-id').value;
            
            formData.append('name', document.getElementById('product-name').value);
            formData.append('description', document.getElementById('product-description').value);
            formData.append('ingredients', document.getElementById('product-ingredients').value);
            formData.append('benefits', document.getElementById('product-benefits').value);
            formData.append('usage', document.getElementById('product-usage').value);
            formData.append('price', document.getElementById('product-price').value);
            
            const imageFile = document.getElementById('product-image').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }
            
            try {
                const url = editId ? `/api/products/${editId}` : '/api/products';
                const method = editId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    body: formData
                });
                
                if (response.ok) {
                    showMessage(editId ? 'Product updated successfully!' : 'Product added successfully!');
                    document.getElementById('product-form').reset();
                    document.getElementById('image-preview').classList.add('hidden');
                    cancelEdit();
                    loadProducts();
                } else {
                    throw new Error('Failed to save product');
                }
            } catch (error) {
                console.error('Error saving product:', error);
                showMessage('Error saving product. Please try again.', 'error');
            }
        });

        // Profile form submission
        document.getElementById('profile-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('name', document.getElementById('doctor-name').value);
            formData.append('contact', document.getElementById('doctor-contact').value);
            formData.append('email', document.getElementById('doctor-email').value);
            formData.append('address', document.getElementById('doctor-address').value);
            formData.append('bio', document.getElementById('doctor-bio').value);
            
            const photoFile = document.getElementById('doctor-photo').files[0];
            if (photoFile) {
                formData.append('photo', photoFile);
            }
            
            try {
                const response = await fetch('/api/doctor', {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    showMessage('Profile updated successfully!');
                } else {
                    throw new Error('Failed to update profile');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                showMessage('Error updating profile. Please try again.', 'error');
            }
        });

        // Brand form submission
        document.getElementById('brand-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('name', document.getElementById('brand-name').value);
            formData.append('tagline', document.getElementById('brand-tagline').value);
            
            const logoFile = document.getElementById('brand-logo').files[0];
            if (logoFile) {
                formData.append('logo', logoFile);
            }
            
            try {
                const response = await fetch('/api/brand', {
                    method: 'PUT',
                    body: formData
                });
                
                if (response.ok) {
                    showMessage('Brand settings updated successfully!');
                } else {
                    throw new Error('Failed to update brand settings');
                }
            } catch (error) {
                console.error('Error updating brand settings:', error);
                showMessage('Error updating brand settings. Please try again.', 'error');
            }
        });

        // Password form submission
        document.getElementById('password-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // Validate passwords match
            if (newPassword !== confirmPassword) {
                showMessage('New passwords do not match!', 'error');
                return;
            }
            
            // Validate password length
            if (newPassword.length < 6) {
                showMessage('New password must be at least 6 characters long!', 'error');
                return;
            }
            
            const formData = {
                currentPassword,
                newPassword
            };
            
            try {
                const response = await fetch('/api/admin/password', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Password updated successfully!');
                    // Clear the form
                    document.getElementById('password-form').reset();
                } else {
                    showMessage(data.error || 'Failed to update password', 'error');
                }
            } catch (error) {
                console.error('Error updating password:', error);
                showMessage('Error updating password. Please try again.', 'error');
            }
        });

        // Edit product
        async function editProduct(productId) {
            try {
                const response = await fetch(`/api/products/${productId}`);
                const product = await response.json();
                
                document.getElementById('edit-product-id').value = productId;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-description').value = product.description;
                document.getElementById('product-ingredients').value = product.ingredients || '';
                document.getElementById('product-benefits').value = product.benefits || '';
                document.getElementById('product-usage').value = product.usage || '';
                document.getElementById('product-price').value = product.price || '';
                
                if (product.image) {
                    document.getElementById('preview-img').src = product.image;
                    document.getElementById('image-preview').classList.remove('hidden');
                }
                
                document.getElementById('submit-btn').textContent = 'Update Product';
                document.getElementById('cancel-btn').classList.remove('hidden');
                
                // Scroll to form
                document.getElementById('product-form').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error loading product for edit:', error);
                showMessage('Error loading product details.', 'error');
            }
        }

        // Cancel edit
        function cancelEdit() {
            document.getElementById('edit-product-id').value = '';
            document.getElementById('product-form').reset();
            document.getElementById('image-preview').classList.add('hidden');
            document.getElementById('submit-btn').textContent = 'Add Product';
            document.getElementById('cancel-btn').classList.add('hidden');
        }

        // Delete product
        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    const response = await fetch(`/api/products/${productId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        showMessage('Product deleted successfully!');
                        loadProducts();
                    } else {
                        throw new Error('Failed to delete product');
                    }
                } catch (error) {
                    console.error('Error deleting product:', error);
                    showMessage('Error deleting product. Please try again.', 'error');
                }
            }
        }

        // Load content when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            loadDoctorProfile();
            loadBrandSettings();
        });
    </script>
</body>
</html>
